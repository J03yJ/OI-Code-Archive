# subtask1

暴力枚举正方形的左上角右上角坐标，复杂度 $O(n^4)$。

# subtask2

发现 $k\le 20$，则可以对k进行容斥，算出包含 $k$ 的，再用总的减去包含 $k$ 的方案数，复杂度 $O(n2^k)$。

# subtask3

$k=0$ 的情况，即只用 $O(1)$ 算出总的正方形个数就行。

考虑朴素式子，$\sum\limits_{i+j\le n+1}\min(i,j)$。

优化为 $O(n)$，$\sum\limits_{k=1}^{\lfloor\frac{n+1}{2}\rfloor}k(1+2(n-2k+1))$。

优化为 $%$$O(1)$，设 $\lfloor \frac{n+1}{2}\rfloor=T,\frac{T(1+T)(3+2n)}{2}-4(\frac{T(T+1)(2T+1)}{6})$。

值得一提的是，这个 $O(1)$ 的式子也是第一题构造最大值的通项。

# subtask4

考虑容斥过程，每次会计算包含“包含 $k$ 个点的最小矩阵”的矩阵个数。

那我们考虑枚举这个长方形 $B$，求所有集合 $I$ 的 $(-1)^{|I|}$ 和，使得集合 $I$ 使得包含这个集合黑点的最小矩阵就是 $B$。

那么一个注意是如果 $B$ 内部包含 $t\ge 1$ 个点，则其贡献为 $0$。如果 $B$ 内部没有点，则贡献为 $(-1)^{B上黑点个数}$。

再注意所有满足 $B$ 内部没有点的 $B$ 最多有 $4$ 个点。所以暴力枚举所有大小 $\le4$ 的 $I$，算出 $B$。计算其贡献即可。

复杂度 $O(k^4T)$。其中 $T$ 是计算一个矩阵答案的复杂度。	

# subtask5

在 subtask4 中，复杂度瓶颈为计算矩阵答案的复杂度 $T$，我们只要使 $T$ 是 $O(1)$ 的，就可以绕开 $n$，从而通过此题。

考虑一个矩阵答案的贡献：

![](https://cdn.luogu.com.cn/upload/image_hosting/alt9p1eh.png)

考虑图中的红色矩形，计算它的贡献时，将他右上角的“三角”和左下角的矩阵给拉出来。

也就是说，我们需要在右上黑色块和左下黑色块中各选取一个点使得这两点构成的矩形是一个正方形。

那么我们划出直线连接两个黑色块，那么整体的答案就是直线两端的积的和。

考虑如何快速计算积的和。

注意到左下角的数的序列，一定呈这样的规律排布 $[1,2,...,\operatorname{MAX}-1][\operatorname{MAX},...,\operatorname{MAX}][\operatorname{MAX}-1,...,2,1]$（分三段）。

右上角的数的序列，一定呈这样的规律排布 $[1,1,2,2,...,{\rm{MAX-1}}][\operatorname{MAX-1} \operatorname{or} \operatorname{MAX}][\operatorname{MAX-1},...,2,2,1,1]$（也分三段）。

那么将这两种一一配对，譬如最朴素的，$[1,2,...,\operatorname{MAX}-1]$与$[1,1,2,2,...,\operatorname{MAX}-1]$配对。

一定有 $O(1)$ 的式子可以进行计算，因为推导过于冗长，就不在此进行推导，请选手自行发掘。
