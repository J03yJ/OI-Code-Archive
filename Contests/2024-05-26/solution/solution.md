## 第一题：花园 

### Case 1：高度只有两个值,且边界高度均为最大值。 
统计高度较小的格子的数量，设为x；高度差设为$y$, 则$xy$为答案。
期望得分5分 

### Case 2：高度只有两个值，不保证边界的高度最高。
对较低的格子进行bfs，访问具有相同高度的连通块。如果该区域封闭，则统计该区域的格子数量。
最后用封闭区域的格子数量乘以高度差即为答案。 
期望得分5分。

### Cas 3,4：$n \times m \leq 20$

求每个格子能储存多少水，即求每个格子到边界的所有路径上最大高度的最小值与该格子的差值。

可以从每个格子出发，搜索所有路径, 路径遇到边界的格子即可终止。设非边界的格子为$x$个，则时间复杂度为$O(x3^x)$


### Cas 5,6：$n=3$，且保证第一行和最后一行的高度均为最大值。 
此时可以看做是一维的情况。 
求每个格子，求它以及它左边的所有格子的最大高度。
右边也求一次，取较小值。该较小值与该格子高度之差即为该格子的储水量。
时间复杂度为$O(m)$. 


### Cas $7 \sim 20$: 
#### 解法一：

问题的关键是求每个格子到边界的所有路径上最大高度的最小值。
反过来，即为求边界到每个格子的路径上最大高度的最小值，这可以看做是一个最短路问题的变形。
将花园以外的区域看做是超级源点，它与边界上每个格子都相邻。
设$dis_i$表示源点到$i$的路径上最大高度的最小值,$h_i$表示格子$i$的高度。 
则$dis_i = min(dis_i, max(dis_j,h_i)$ 其中$i,j$两个格子相邻。 
则答案为$\sum{|dis_i-h[i]|}$。   
使用优先队列，时间复杂度为$O(nmlog(nm))$

#### 解法二：
使用并查集。先对所有格子按高度排序。从高度最小的格子开始，当它储存了水以后，其高度上升，当上升到与周围某个更高的格子高度相等时，可以将较低格子的集合与较高格子的集合合并。合并之前，将较低格子的集合大小乘以上升水位的高度差，即为这一次的贡献。如果集合中包含了边界上的格子，该集合就废掉了，后续不再计算贡献。

时间复杂度为$O(nmlog(nm)+nm\alpha(nm))$，其中$\alpha(nm)$为并查集的时间复杂度。



## 第二题： 外星人搬砖 brick

一、直接输出"-1 -1"，可以得到5分。 
如果$n$是偶数，则编号为奇数的堆，与编号为偶数的砖堆，砖数必须相等，不然无解。

二、20分做法
数据规模较小，乱搞。


三、60分做法

设初始时第$i$堆砖的块数为$a_i$, 最后经过调整，每堆砖块全部变为$L$。可知$min_{a_i}-1 \leq L \leq max_{a_i}+1$.
设$x_1$表示将第一堆和第二堆同时增加的次数，$x_2$表示第二堆和第三堆同时增加的次数，$\dots$， $x_n$表示第$n$堆和第$1$堆同时增加的次数。
则有：
$\begin{aligned} \begin{cases} x_1+x_2&=L-a_2 \\ x_2+x_3 &= L-a_3 \\ \;\;\vdots \\ x_n+x_1 &= L-a_1 \end{cases} \end{aligned}$

该方程有$n+1$个未知数。 如果我们枚举$L$， 就只有$n$个未知数了。是不是可以解方程呢？

奇偶分开考虑：

1、如果$n$是奇数，此时，如果$nL-\sum_{a_i}$为奇数，则方程是无整数解的，否则有唯一的整数解。可以解出方程，求出达到统一$L$下的操作次数，即$|x_1|+|x_2|+\dots+|x_n|$。

2、如果$n$是偶数：

  + 如果$\sum\limits_{i=1}^{n/2}a_{2i} \neq \sum\limits_{i=1}^{n/2}a_{2i-1}$,则无解；
  + 否则，方程有多解。比如求出了$x_1,x_2,\dots,x_n$后，将$i$是奇数的$x_i$增加$1$;将$i$为偶数的$x_i$减小$1$,仍然是方程的解。因为$n$个方程本质上是线性相关的。第$n$方程可以由前$n-1$个方程得到。

    可以将$x_i$看做是二维平面中的点$(i, x_i)$，要让$|x_1|+|x_2|+|x_3|+\dots+|x_n|$最小，即是让这些点到$x$轴的距离之和最小。 
    
    可以任意选择一个$x_i$, 修改它的值，选哪个效果都是类似的。不妨选择$x_1$,  发现：
    
    ​	如果$x_1$增加$\delta$，则$x_2$会减小$\delta$，而$x_3$又增加$\delta$, $\dots$, $x_n$减小$\delta$; 反之亦反。 
    ​	而$|x_i|$的变化规律则是要么先减小后增大，要么一直增大。 
    设$f(\delta)=|x_1+\delta|+|x_2-\delta|+\dots+|x_n-\delta|$，可知$f(\delta)$的函数图像是一个拱形曲线。我们可以轻松找到最低的点。
    可以考虑将$x_1$增大或减小，看减小的$|x_i|$有多少个，让个数尽量等于$n/2$即可。 如果个数不能等于$n/2$, 则尽量接近$n/2$. 
    
    

时间复杂度为$O(Ln)$，预计得分60分。 

三、80分做法 

显然，操作的次数与最终砖块的高度的关系也是一个拱形函数。即在某个高度范围内时，操作次数能达到最小值，大于或小于这个高度范围时，操作次数都将增加。
所以，我们可以三分高度，这样时间复杂度为$O(Nlog_3(H^2))$ 
期望得分80分。 

三、100分做法
其实我们可以不需要枚举$L$.

 观察$L$的变化对最终答案的影响。还是分奇偶来考虑。 
1、当$n$为偶数时，直接设$L$为$0$，先求出$x$的解。
将$x_i$根据$i$的奇偶分为两组，发现不管是调整$L$,还是调整$x_1$, 每一组内部，其相对位置都不会变，要么整体上升，要么整体下降。
我们只要让每一组的中位数都调整到$x$轴上即可。



2、当$n$是奇数，$L$的值根据$\sum_{a_i}$的奇偶性决定，如果为奇数，则$L$设为$1$，否则$L$设为$0$. 
当$L$增大2或减小2时，可以看做所有的$(i,x_i)$均往上或往下移动一个单位。
所以，我们只需要整体移动所有$(i,x_i)$，让中位数那个点移动到$x$轴上，此时答案一定是最小的。 

时间复杂度为$O(N)$. 


## 第三题：
(1)、50分做法：
设$a_i$表示目标曲子的第$i$个音符，$s_i$表示目标曲子的前缀$i$。 
设$f_i$表示第一次出现$s_i$的期望按键次数。 
则有: $f_i = f_{i-1} + \frac{1}{m} +\sum_{j\neq a_i}  \frac{1}{m}(f_i-f_{k}+1)$   
其中$s_k$是指$(s_{i-1},j)$的border。所谓border，是指一个字符串的最大的公共前后缀。$(s_{i-1},j)$表示前缀$s_{i-1}$后面连一个音符$j$。
$k$可以理解为，已经弹奏出了前$i-1$个音符，结果下一个按键按错了，不是$a_{i}$，但却能够匹配目标曲子的前缀k。

移项可得：
$f_i=mf_{i-1}+m-\sum_{j\neq a_i} f_k$
直接做，时间复杂度为$O(nm)$. 

(2)、100分做法

观察上面的式子，等式右边减去的$\sum_{j\neq a_i}f_k$，其实大部分和$f_{fail_i}$是相同的，只是一点点小差别，即$f_{fail_i}$包含了按下$a_{i}$跳转的贡献，但没有包含按下$a_{fail_i+1}$的贡献。修正一下，就可以了。
时间复杂度为$O(n)$。 

## 第四题： 

![](./T4.png)

