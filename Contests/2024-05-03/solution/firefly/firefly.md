# firefly

## 前言

本题实际难度 T2。

给出了非常的多不难拿的部分分，通过 $n \leq 100,K=4$ 这档分可以比较好的联想到正解。

即使没有想出来，把部分分拿满也能获得可观的分数。

## Subtask1

写对文件，通过编译

期望得分 $10pts$

## Subtask2

$K_1$ 和 $K_2$ 计数都是平凡的，注意处理重边！

期望得分：$20pts$

## Subtask3

暴力枚举 $K_3$ 的 $3$ 个点 并 check即可。

期望得分：$30pts$

## Subtask4

这是一档比较重要的部分分。

我们考虑枚举 $K_4$ 中的三个点 $a,b,c$ 并 check 他们是否为 $K_3$

那么我们需要构成 $K_4$ 只需要再找到一个点 $d$ 使其与 $a,b,c$ 均有连边。

下文，我们称 $N(a)$ 表示 $a$ 的邻域，也就是与 $a$ 相连的点的集合。

换句话说 $|N(a) \and N(b) \and N(c)|$ 就为可行的 $d$ 的数量。 

这就很显然了，我们使用 bitset 维护每个 $N(x)$，最后答案除 $4$ 去重。

时间复杂度 $O(\frac{n^4}{\omega})$ 

## Subtask5

是一个很经典的问题 **无向图三元环数数**，但是凭空捏出正解并非不可能。

好像有 bitset 做法，本文描述的是常见的根号分治分析复杂度的做法。

我们考虑给边定向：

具体的，我们将度数较小的点连向度数较大的点，若度数相同则标号小的点连向标号大的点。

这实际是为了均摊复杂度，让复杂度与出度有关。

那么原无向图中的三元环，会唯一对应到新图中 $<u\rightarrow v>,<u \rightarrow w>, <v\rightarrow w>$ 的三元组。

我们考虑暴力统计这样的三元组。

具体的，枚举一个点 $u$，枚举 $v \in N(u)$ 将其打上 Tag，然后再枚举 $w \in N(v)$ 检查其是否有 Tag

其复杂度是 $O(\sum_i^m out(v_i))$，其中 $v_i$ 为有向边终点，$out(x)$ 为 $x$ 的出度。

接下来我们使用根号分治分析此复杂度，证明其是 $O(m\sqrt m)$​ 的。

下文称 $\deg(x)$ 为原无向图中 $x$ 的度数。

$1^o$  $\deg(x) \leq \sqrt m$ 显然有 $out(x) = O(\sqrt m)$

$2^o$ $\deg(x) > \sqrt m$ 这样的 $x$ 是 $O(\sqrt m)$ 的，注意到我们连边时只能朝度数大的点连边，所以显然有 $out(x) = O(\sqrt m)$

所以算法复杂度显然是 $O(m \sqrt m)$ 的。

## Subtask 6

算法四 告诉了我们很重要的性质，我们可以利用 $K_3$ 构造出 $K_4$。

但是枚举单点这个操作卡死了他的复杂度，我们希望所有操作都跟 $K_3$ 有关。

我们考虑使用 $(a,b,c)$ ，$(a,b,d)$，$(a,c,d)$  三个 $K_3$  就可以覆盖满 $K_4$​

我们继续用 算法五 的方式给边定向，这样就不会算重。

我们考虑对于每个 $x$ 建一张新图，下文称为 $x$ 图。

在 $x$ 图中 $u,v$ 有边当且仅当 $(x,u,v)$ 为三元环，我们使用 bitset 来存这些图。

那么同时存在 $(a,b,c), (a,b,d), (a,c,d)$ 就相当于在 $a$ 图中存在三元环 $(b,c,d)$

这部分用算法四的 bitset 取交来做就行了。

总复杂度仍然需要均摊分析，比较麻烦，这里就不赘述了，感兴趣的同学可以自己证明一下。

总复杂度是 $O(\frac{m^2}{\omega})$ 的。
