# travel

## 前言

本题做为 T4，但没有设计过难的算法，这也是本套题的趋势。

本题思维难度较大，技巧性较强，期望选手更多的尝试多拿部分分。

## Subtask1

暴力乱搜索即可。

期望得分：$10pts$

## Subtask2

题目等价于数数有多少子序列组成的 $(len,Sum)$ 二元组。

将这两个状态压到状态，发现他可以 bitset，暴力 DP 即可。

复杂度 $O(\frac{n^2S}{w})$。

期望得分：$20pts$

## Subtask3

算法二的这个状态没有什么前途，考虑利用至少有 $\lceil \frac{1}{5}S \rceil$ 个 $1$ 这个条件设计状态。

直接扔结论，我们十分聪明的发现加入 $1$ 是不影响 $Sum-len$ 的值的，而 $(Sum-len,Sum)$ 与 $(len,Sum)$​ 显然是等价的。

我们改变状态为 $(Sum-len,Sum)$，我们考察加入 $1$ 对这个状态的影响，其第一维不变，$Sum\leftarrow Sum+1$

所以可以预见的是，大部分时候会形成 $(Sum-len,[l,r])$ 的连续段。

我们可以证明对于一个 $Sum-len$ 这样的连续段小于 $5$ 个，实测在大数据下似乎不超过 $2$​​ 个。



> prov：
>
> 记  $b_i$ 为 $i$ 在序列  $a$ 中出现的次数，显然 $b_i \geq 0$，所有可能的 $sum$ 在 $[0,S]$，即 $0\leq sum \leq S \leq 5b_1$，对于每个 $sum-len$，每个可行的 $sum$ 区间长度不小于 $b_1 + 1$，若至少有 $5$ 个可行的 $sum$ 区间，则其总长度至少为 $5(b_1 + 1)>5b_1 + 1$。
>
> 矛盾，故每个 $sum-len$ 最多只有 $4$ 个可行的 $sum$​ 连续段。

这使得我们想要对于每个 $Sum-len$ 求出其连续段表示，我们发现我们可以做个类似背包的东西。

我们将所有 $1$ 从序列除去，假设有 $b$ 个 $1$，初始状态 $(a_i-1,[a_i,a_i+b])$，然后我们不断将每个 $a_i$ 插入状态，考察其影响。

会发现就是个背包合并，第一维直接相加，第二维做区间合并。

根据颜色段均摊相关的知识，我们容易知道暴力合并区间的复杂度是完全正确的。

根据前面的结论，可以做到 $O(nS)$。

期望得分： $30pts$​

## Subtask4

这档特殊性质旨在引导选手发现不同的数最多有 $O(\sqrt S)$ 种。

所以复杂度是 $O(S\sqrt S)$ 的。

## Subtask5

由于本题复杂度比较紧，常数也较大，设置了一档防止卡常的 Subtask

## Subtask6

无论是根据部分分还是直接观察，我们容易发现本质不同的元素个数是极少的。

具体的其最多为 $O(\sqrt S)$ 级别，而显然我们的转移只跟其数值有关，所以可以将其压缩，二进制分组。

这样复杂度可以做到 $O(S \sqrt S \log n)$，已经基本可以通过。

实际上我们可以分析出更紧的界，其实际复杂度是 $O(S \sqrt S)$ 的，完全可以通过。

分析比价复杂，选手可以自行探究，不在此赘述。