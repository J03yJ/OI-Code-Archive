# Aventurine

## 前言

本题实际难度为 T3 or T4，放在 T2，是希望大家不要重蹈出题人 NOIP2022 的惨剧，能够制定合理的开题顺序。

其次是如果没做过 **最小乘积凸包** 相关的套路是很难做出此题的，虽然目前大赛更加考察不那么套路的思维能力，但是套路的积累同样重要。

## Subtask1

写对文件，通过编译

期望得分 $5pts$

## Subtask2

枚举选择的子集 $S$，再枚举子集 $T$ 暴力计算价值。

复杂度 $O(2^{2n})$

期望得分 $20pts$

## Subtask3

这个价值是非常线性基的形式，我们容易发现，最大价值是一开始就容易确定的。

具体的，直接把 所有 $a_i$ 全部丢进线性基，若线性基内有 $k$ 个元素，则价值为 $2^k$

复杂度 $O(2^n)$

期望得分 $35pts$

## Subtask4

我们先求出整体的线性基。

那么显然只保留线性基中的元素，线性基大小不变。且此时代价一定变小。

因此设考虑全集时线性基内有 $k$ 个元素，那么相当于选出 $k$ 个数使得它们线性无关，且代价最小。

对于 $b_i=1$​ 的情况，相当于代价只有一维。贪心地猜测，此时一定是按照 $c_i$ 从小到大尝试加入线性基。

可以证明这样一定最优。

复杂度 $O(n\log v)$

期望得分 $45pts$

## Subtask5

算法四解决了 $n \leq 100$ 时，代价只有一维的问题。

本 Subtask 中，$b_i \leq 2$ 则代价中有一维范围只为 $n$ 

很容易想到对 $b$​ 这一维做背包，使用算法四解决问题。

时间复杂度：$O(n^2\log v)$

期望得分：$60pts$

## Subtask6

本 Subtask 是给到想到了 **最小乘积凸包** 套路怎么做，但不会算法四，需要用高复杂度解决一维代价问题的选手。

本算法会在下文详细讲解。

期望得分：$35+15pts$

## Subtask7

本 Subtask 是防止有选手被卡常，以及放过一些因各种原因复杂度多几只 $\log$​ 的选手。

期望得分：$90pts$

## Subtask8

对于形如最小化 $\sum_{i}{B_i} \times \sum_{i}{C_i}$​ 有凸包套路 [Link](https://www.luogu.com.cn/problem/P5540)

具体的，我们考虑建系，对于一个集合 $S$，令 $x=\sum_i{B_i},y=\sum_i{C_i}$，形成 $S\rightarrow (x,y)$ 的映射。

那我们就是要在这个有很多点的平面上找到 $x \times y$ 最小的点。

这个问题可以用如下方式解决：

我们找到 $x$ 最小的点 $A$，以及 $y$ 最小的点 $B$，称 $AB$​ 为基准线，将平面分为两个半平面。

注意到这相当于只最小化 $\sum_i B_i$ 一维代价，也就是 **算法四** 解决的问题

显然 $AB$ 上面的半平面是没有意义的。

我们考虑继续用这样的方式缩小半平面。

我们尝试找到一个点 $C$ ，其距离 $AB$ 最远，也就是 $S_{\Delta ABC}$ 最大的点。

此时递归 $AC$ 与 $BC$ 为基准线，分治解决问题。

问题只剩下如何快速找到 $C$ 点。

用叉积表示 $S_{\Delta ABC}$​：
$$
\begin{align}
S_{\Delta ABC} &= \overrightarrow{AB}×\overrightarrow{AC} \\
  &= (x_B−x_A)(y_C−y_A)−(y_B−y_A)(x_C−x_A)\\
  &=(x_B−x_A)\times y_C+(y_A−y_B)\times x_C+y_Bx_A−x_By_A
\end{align}
$$
其中后两项是常量。

那么找 $S_{\Delta ABC}$ 最大的 $C$ 相当于找一个代价为 $(x_B-x_A)\times y + (y_A -y_B)\times x$ 并且满足最大化星琼要求的点。

容易发现这也是一个一维代价问题，同样用 **算法四** 解决。

值得注意的是其复杂度，如果我们观察算法过程中所有决策点，会发现其实际上是遍历了所有点的下凸壳。

而一个平面随机撒点期望凸包大小是 $O((na)^{\frac{2}{3}})$ 级别。

根据此套路，套用算法四，这部分复杂度为 $O(n\log n)$，套上板子复杂度 $O((na)^{\frac{2}{3}}n\log n)$

由于在 $n \leq 1000$ 下 $O(\log n)$ 与 $O(n^{\frac{1}{3}})$ 相近，并且线性基与最小乘积凸包均不容易跑满

所以加上多测整体远小于 $O(n^2)$。

并且凸包点数以及线性基复杂度基本无法卡满，可以十分快速的通过。

